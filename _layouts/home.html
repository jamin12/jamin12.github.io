---
layout: default
---

{% include lang.html %}

<!-- 
  ========================================
  포스트 가져오기 로직
  ========================================
-->

{% if page.target_category %}
<!-- 
    CASE 1: 카테고리 필터링 모드
    index.html에 'target_category'가 설정된 경우, 해당 카테고리의 글만 보여줍니다.
    이 모드에서는 페이지네이션이 비활성화됩니다.
  -->

{% assign category_posts = '' | split: '' %} {% assign target_cats =
page.target_category %}

<!-- target_category가 배열인지 확인하기 위한 꼼수 (size 체크 등) 혹은 
      Jekyll에서 배열/문자열 구분이 모호하므로, 그냥 append 해보고 로직 처리.
      하지만 단순히, 리스트인 경우와 스트링인 경우를 처리하기 위해 split을 활용할 수 있음. -->

<!-- 문자열인 경우 배열로 변환 -->
{% if target_cats.first %}
<!-- 이미 배열인 경우 그대로 사용 -->
{% else %} {% assign target_cats = target_cats | split: '#####' %}
<!-- 배열로 만듦 -->
{% endif %} {% for cat_name in target_cats %} {% assign posts_in_cat =
site.categories[cat_name] %} {% if posts_in_cat %} {% assign category_posts =
category_posts | concat: posts_in_cat %} {% endif %} {% endfor %}

<!-- 중복 제거 (혹시 글이 여러 카테고리에 속해있을 경우) 및 날짜순 정렬 -->
{% assign category_posts = category_posts | uniq | sort: 'date' | reverse %}

<!-- 카테고리 내에서 고정(Pin)된 글과 일반 글 분리 -->
{% assign all_pinned = category_posts | where: 'pin', 'true' %} {% assign
all_normal = category_posts | where_exp: 'item', 'item.pin != true and
item.hidden != true' %}

<!-- 합치기: 고정된 글을 먼저 보여주고, 그 뒤에 일반 글 배치 -->
{% assign posts = all_pinned | concat: all_normal %} {% elsif
page.exclude_category %}
<!-- 
    CASE 2: 카테고리 제외 모드
    index.html에 'exclude_category'가 설정된 경우, 해당 카테고리를 제외한 모든 글을 보여줍니다.
    이 모드에서는 페이지네이션이 비활성화됩니다.
  -->

{% assign excluded_cats = '' | split: '' %} {% assign target_ex_cats =
page.exclude_category %}

<!-- 문자열인 경우 배열로 변환 -->
{% if target_ex_cats.first %}
<!-- 이미 배열인 경우 -->
{% else %} {% assign target_ex_cats = target_ex_cats | split: '#####' %} {%
endif %} {% assign all_posts = site.posts %} {% assign filtered_posts = '' |
split: '' %} {% for post in all_posts %} {% assign is_excluded = false %} {% for
cat in post.categories %} {% if target_ex_cats contains cat %} {% assign
is_excluded = true %} {% break %} {% endif %} {% endfor %} {% unless is_excluded
%} {% assign filtered_posts = filtered_posts | push: post %} {% endunless %} {%
endfor %}

<!-- 중복 제거 및 날짜순 정렬 -->
{% assign category_posts = filtered_posts | uniq | sort: 'date' | reverse %}

<!-- 카테고리 내에서 고정(Pin)된 글과 일반 글 분리 -->
{% assign all_pinned = category_posts | where: 'pin', 'true' %} {% assign
all_normal = category_posts | where_exp: 'item', 'item.pin != true and
item.hidden != true' %} {% assign posts = all_pinned | concat: all_normal %} {%
else %}
<!-- 
    CASE 3: 기본 페이지네이션 모드
    모든 글을 페이지네이션과 함께 보여줍니다.
    고정된 글(Pin)이 첫 페이지 상단에 오도록 처리합니다.
  -->
{% assign all_pinned = site.posts | where: 'pin', 'true' %} {% assign all_normal
= site.posts | where_exp: 'item', 'item.pin != true and item.hidden != true' %}
{% assign posts = '' | split: '' %}

<!-- 페이지네이션 범위 계산 -->
{% assign visible_start = paginator.page | minus: 1 | times: paginator.per_page
%} {% assign visible_end = visible_start | plus: paginator.per_page %}

<!-- 1. 고정된 글 추가 (현재 페이지 범위에 포함되는 경우) -->
{% if all_pinned.size > visible_start %} {% if all_pinned.size > visible_end %}
{% assign pinned_size = paginator.per_page %} {% else %} {% assign pinned_size =
all_pinned.size | minus: visible_start %} {% endif %} {% for i in
(visible_start..all_pinned.size) limit: pinned_size %} {% assign posts = posts |
push: all_pinned[i] %} {% endfor %} {% else %} {% assign pinned_size = 0 %} {%
endif %}

<!-- 2. 일반 글 추가 (남은 공간 채우기) -->
{% assign normal_size = paginator.posts | size | minus: pinned_size %} {% if
normal_size > 0 %} {% if pinned_size > 0 %} {% assign normal_start = 0 %} {%
else %} {% assign normal_start = visible_start | minus: all_pinned.size %} {%
endif %} {% assign normal_end = normal_start | plus: normal_size | minus: 1 %}
{% for i in (normal_start..normal_end) %} {% assign posts = posts | push:
all_normal[i] %} {% endfor %} {% endif %} {% endif %}

<!-- 
  ========================================
  포스트 목록 렌더링
  ========================================
-->

<div id="post-list" class="flex-grow-1 px-xl-1">
  {% for post in posts %} {% include post-card.html %} {% endfor %}
</div>

<!-- 
  ========================================
  페이지네이션 컨트롤
  ========================================
  카테고리 필터링 모드가 아닐 때만 페이지네이션 표시
-->
{% unless page.target_category or page.exclude_category %} {% if
paginator.total_pages > 1 %} {% include post-paginator.html %} {% endif %} {%
endunless %}
