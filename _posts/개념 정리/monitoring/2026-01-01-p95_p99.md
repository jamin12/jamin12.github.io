---
layout: post
title: "p95, p99"
date: 2026-01-01
categories: [개념정리, monitoring]
tags: [p99, p95, 러너스하이2_주제2]
---

서버 성능 모니터링에서 가장 흔히 접하는 지표는 평균 응답 시간이다.
하지만 실제 운영 환경에서 평균값은 문제를 희석시킨다.
실질적인 성능 상태를 파악하기 위해 **p95, p99 (percentile, 분위수)** 지표를 사용한다.

## p95, p99의 의미

응답 시간을 정렬했을 때 특정 순위에 위치한 값을 의미한다.

* **p95** : 전체 요청 중 95%가 이 시간 이내에 처리됨을 의미한다. (상위 5% 경계값)
* **p99** : 전체 요청 중 99%가 이 시간 이내에 처리됨을 의미한다. (상위 1% 경계값)

가장 느린 요청(Max)을 의미하는 것이 아니다.

## 산정 방식 예시

요청 100건의 응답 시간이 다음과 같다고 가정한다.

| 요청 수 | 응답 시간 |
| ------- | --------- |
| 90건    | 100ms     |
| 5건     | 300ms     |
| 4건     | 800ms     |
| 1건     | 3000ms    |

이를 시간순으로 정렬했을 때의 값은 아래와 같다.

* **p95** : 95번째 값인 **300ms**
* **p99** : 99번째 값인 **800ms**

가장 느린 3000ms 요청은 p99 계산에 포함되지 않는다.

## 최악의 값(Max)을 제외하는 이유

운영 환경에서는 불가피한 지연 요소가 존재한다.

* 네트워크 패킷 유실 및 재전송
* GC(Garbage Collection) 수행
* 일시적인 외부 API 지연

이러한 단발성 튀는 값(Outlier)까지 모두 감시하면 알람이 과도하게 발생한다.
p95, p99는 우연히 발생한 극단값은 제외하고, **반복적으로 발생하는 지연**을 감지하기 위해 사용한다.

## 감지 패턴

### 상황 A: 일시적 지연

1000건 중 1건이 10초 걸리고, 나머지는 200ms인 경우.
p99는 약 200ms로 유지된다.
무시해도 되는 이벤트로 판단한다.

### 상황 B: 구조적 지연

1000건 중 10~15건이 8~10초 걸리는 경우.
p99는 8~10초로 상승한다.
이는 특정 조건에서 지속적인 병목이 발생하고 있음을 의미한다.

## 장애 전조로서의 p99

시스템 장애는 보통 다음 순서로 지표가 악화된다.

1. **p99 상승**: 큐 대기, 커넥션 풀 부족 등 일부 요청에서 지연 발생
2. **p95 상승**: 지연되는 요청 비율 증가
3. **평균 상승**: 전체 시스템 성능 저하

평균이 오르면 이미 장애가 진행 중인 경우가 많다.
p99는 장애의 전조 증상을 파악하는 선행 지표 역할을 한다.

## 실무 활용

평균이 주는 착시를 피하고, 실제 사용자가 체감하는 성능을 보기 위해 다음 기준을 주로 참고한다.

* p95 < 300ms
* p99 < 1s

p95와 p99의 격차가 벌어진다면, 일부 요청에서만 문제가 발생하고 있다는 신호다.
이 경우 로그, DB 락, 스레드 풀 상태 등을 점검한다.
