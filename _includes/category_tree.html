{% assign posts_list = include.posts %} {% assign current_depth = include.depth
%}

<!-- Collect sub-categories at this depth -->
{% assign sub_categories = '' | split: '' %} {% for post in posts_list %} {%
assign cat_at_depth = post.categories[current_depth] %} {% if cat_at_depth %} {%
unless sub_categories contains cat_at_depth %} {% assign sub_categories =
sub_categories | push: cat_at_depth %} {% endunless %} {% endif %} {% endfor %}
{% assign sub_categories = sub_categories | sort %} {% if sub_categories.size >
0 %}
<ul class="list-group">
  {% for sub_category in sub_categories %}
  <li class="list-group-item">
    <div class="d-flex justify-content-between align-items-center">
      <span>
        <i class="far fa-folder fa-fw"></i>
        {% capture _sub_ctg_url %}/categories/{{ sub_category | slugify |
        url_encode }}/{% endcapture %}
        <a href="{{ _sub_ctg_url | relative_url }}" class="mx-2"
          >{{ sub_category }}</a
        >
      </span>
      {% assign posts_size = site.categories[sub_category] | size %}
      <span class="text-muted small font-weight-light">
        {{ posts_size }} {% if posts_size > 1 %} {{
        site.data.locales[lang].categories.post_measure.plural | default:
        site.data.locales[lang].categories.post_measure }} {% else %} {{
        site.data.locales[lang].categories.post_measure.singular | default:
        site.data.locales[lang].categories.post_measure }} {% endif %}
      </span>
    </div>

    <!-- Recursive call for next depth -->
    {% assign next_depth = current_depth | plus: 1 %} {% assign next_posts =
    posts_list | where_exp: "item", "item.categories[current_depth] ==
    sub_category" %} {% if next_posts.size > 0 %}
    <div class="ms-3 mt-1">
      {% include category_tree.html posts=next_posts depth=next_depth %}
    </div>
    {% endif %}
  </li>
  {% endfor %}
</ul>
{% endif %}
